# AWS Cognito Configuration
auth.provider=cognito
quarkus.oidc.auth-server-url=${QUARKUS_OIDC_AUTH_SERVER_URL}
quarkus.oidc.client-id=${QUARKUS_OIDC_CLIENT_ID}
# IMPORTANT: Replace YOUR_CLIENT_SECRET with the actual secret from AWS Cognito Console -> App Client
quarkus.oidc.credentials.secret=${QUARKUS_OIDC_CREDENTIALS_SECRET}
quarkus.oidc.application-type=web-app
quarkus.oidc.authentication.fail-on-missing-state-param=false
quarkus.http.port=8080

# Map claims
quarkus.oidc.token.principal-claim=email
quarkus.oidc.roles.role-claim-path=cognito:groups

# Security Rules
quarkus.http.auth.permission.public.paths=/,/logout,/favicon.ico,/api/v1/graphql,/api/v1/logs,/api/v1/readme,/q/health,/q/health/live,/q/health/ready
quarkus.http.auth.permission.public.policy=permit
quarkus.http.auth.permission.protected.paths=/login
quarkus.http.auth.permission.protected.policy=authenticated

# Cognito domain for custom logout endpoint (LogoutResource.java)
cognito.domain=${COGNITO_DOMAIN}

# Frontend URL used after login/logout completion
app.frontend-base-url=http://localhost:4200
app.test.disallowed-usernames=aqdisallowed1,aqdisallowed2,aqdisallowed3,aqdisallowed4,aqtestadmin,fakeuser,fakeuser2,aqtestregularuser,aqtestowneruser,aqtestnopermissionstestuser

# Cookie path for OIDC session
quarkus.oidc.authentication.cookie-path=/

# CORS Configuration
quarkus.http.cors.enabled=true
quarkus.http.cors.origins=http://localhost:4200,${QUARKUS_HTTP_CORS_ADDITIONAL_ORIGINS:}
quarkus.http.cors.methods=GET,PUT,POST,DELETE,OPTIONS,HEAD
quarkus.http.cors.headers=accept,authorization,content-type,x-requested-with
quarkus.http.cors.exposed-headers=content-type,content-length
quarkus.http.cors.access-control-max-age=24H
quarkus.http.cors.access-control-allow-credentials=true

# Disable auto-redirect for XHR/Fetch requests to avoid CORS errors
quarkus.oidc.authentication.java-script-auto-redirect=false

# Dev Configuration: Keycloak + LocalStack (default for local development)
# To use real AWS services locally, run: mvnw quarkus:dev -Dquarkus.profile=aws-local
%dev.auth.provider=keycloak
%dev.quarkus.oidc.auth-server-url=http://localhost:9090/realms/quarkus
%dev.quarkus.oidc.client-id=angular-quarkus-client
%dev.quarkus.oidc.credentials.secret=secret
%dev.quarkus.oidc.roles.role-claim-path=realm_access/roles
quarkus.oidc.token.refresh-expired=true
quarkus.oidc.authentication.session-age-extension=12H

# Versioned GraphQL API endpoint
quarkus.smallrye-graphql.root-path=/api/v1/graphql

# AWS Cognito admin API settings (defaults for dev/test; override via env vars in production)
aws.region=${AWS_REGION:eu-central-1}
cognito.user-pool-id=${COGNITO_USER_POOL_ID:placeholder}
cognito.client-id=${COGNITO_CLIENT_ID:placeholder}

# Test port (dev server uses 8080)
quarkus.http.test-port=8081

%test.app.frontend-base-url=http://localhost:8081

# Keycloak Overrides (Dev/Test)
# (Duplicates removed)
%dev.cognito.domain=ignored
%dev.aws.region=us-east-1
%dev.cognito.user-pool-id=dev-placeholder
%dev.cognito.client-id=dev-placeholder
%dev.quarkus.oidc.authentication.cookie-path=/

%test.quarkus.oidc.auth-server-url=http://localhost:9090/realms/quarkus
%test.quarkus.oidc.client-id=angular-quarkus-client
%test.quarkus.oidc.credentials.secret=secret
%test.quarkus.oidc.roles.role-claim-path=realm_access/roles
%test.auth.provider=keycloak
%test.cognito.domain=ignored
%test.aws.region=eu-central-1
%test.cognito.user-pool-id=test-placeholder
%test.cognito.client-id=test-placeholder
%test.quarkus.oidc.authentication.cookie-path=/
%test.quarkus.oidc.roles.source=accesstoken
%test.quarkus.log.category."io.quarkus.oidc".level=DEBUG

%test.quarkus.log.category."io.quarkus.security".level=DEBUG

%dev.quarkus.oidc.roles.source=accesstoken

%dev.quarkus.keycloak.devservices.realm-path=../.github/keycloak/realm-export.json

# OIDC Secret for session encryption, override in production with a secure value (e.g. from .env or vault)
quarkus.oidc.token-state-manager.encryption-secret=0123456789abcdef0123456789abcdef

quarkus.dynamodb.aws.region=${AWS_REGION:eu-central-1}
quarkus.dynamodb.aws.credentials.type=default

# Dev mode: Use LocalStack
%dev.quarkus.dynamodb.aws.region=us-east-1
%dev.quarkus.dynamodb.aws.credentials.type=static
%dev.quarkus.dynamodb.aws.credentials.static-provider.access-key-id=test
%dev.quarkus.dynamodb.aws.credentials.static-provider.secret-access-key=test
%dev.quarkus.dynamodb.endpoint-override=http://localhost:4566
# Disable Dev Services for DynamoDB, as we use a shared persistent container
%dev.quarkus.dynamodb.devservices.enabled=false

# Test mode: Use ephemeral Dev Services
%test.quarkus.dynamodb.devservices.enabled=true
%test.quarkus.dynamodb.devservices.shared=true

# ============================================================================
# Profile: aws-local
# Use real AWS Cognito + DynamoDB for local testing instead of Keycloak + LocalStack.
# Activate with: mvnw quarkus:dev -Dquarkus.profile=dev,aws-local
# Requires environment variables: QUARKUS_OIDC_AUTH_SERVER_URL, QUARKUS_OIDC_CLIENT_ID,
#   QUARKUS_OIDC_CREDENTIALS_SECRET, COGNITO_DOMAIN, AWS_REGION, COGNITO_USER_POOL_ID
# ============================================================================
%aws-local.auth.provider=cognito
%aws-local.quarkus.oidc.auth-server-url=${QUARKUS_OIDC_AUTH_SERVER_URL}
%aws-local.quarkus.oidc.client-id=${QUARKUS_OIDC_CLIENT_ID}
%aws-local.quarkus.oidc.credentials.secret=${QUARKUS_OIDC_CREDENTIALS_SECRET}
%aws-local.quarkus.oidc.roles.role-claim-path=cognito:groups
%aws-local.cognito.domain=${COGNITO_DOMAIN}
%aws-local.quarkus.dynamodb.aws.region=${AWS_REGION}
%aws-local.quarkus.dynamodb.aws.credentials.type=default
%aws-local.quarkus.dynamodb.devservices.enabled=false

# ============================================================================
# CloudWatch Logs Configuration
# Production: Set cloudwatch.enabled=true and configure AWS_REGION
# Dev: Uses LocalStack endpoint, enabled by default
# ============================================================================
cloudwatch.enabled=${CLOUDWATCH_ENABLED:false}
cloudwatch.log-group=/angular-quarkus-demo
cloudwatch.frontend-log-stream=frontend
cloudwatch.backend-log-stream=backend

# Dev mode: point CloudWatch to LocalStack
%dev.cloudwatch.enabled=true
%dev.cloudwatch.endpoint-override=http://localhost:4566

# Test mode: disable CloudWatch
%test.cloudwatch.enabled=false

# Data seeding: populate DynamoDB with sample data for manual testing
app.seed-data=false
%dev.app.seed-data=true
