# AWS Cognito Configuration
auth.provider=cognito
quarkus.oidc.auth-server-url=${QUARKUS_OIDC_AUTH_SERVER_URL}
quarkus.oidc.client-id=${QUARKUS_OIDC_CLIENT_ID}
# IMPORTANT: Replace YOUR_CLIENT_SECRET with the actual secret from AWS Cognito Console -> App Client
quarkus.oidc.credentials.secret=${QUARKUS_OIDC_CREDENTIALS_SECRET}
quarkus.oidc.application-type=web-app
quarkus.oidc.authentication.fail-on-missing-state-param=false
quarkus.http.port=8080
quarkus.http.same-site-cookie.lax=true

# Map claims
quarkus.oidc.token.principal-claim=email
quarkus.oidc.roles.role-claim-path=cognito:groups

# Security Rules
quarkus.http.auth.permission.public.paths=/,/hello,/logout,/favicon.ico,/api/v1/graphql
quarkus.http.auth.permission.public.policy=permit
quarkus.http.auth.permission.protected.paths=/user,/login
quarkus.http.auth.permission.protected.policy=authenticated

# Cognito domain for custom logout endpoint (LogoutResource.java)
cognito.domain=${COGNITO_DOMAIN}

# Frontend URL used after login/logout completion
app.frontend-base-url=http://localhost:4200
app.test.disallowed-usernames=aqdisallowed1,aqdisallowed2,aqdisallowed3,aqdisallowed4,aqtestadmin,fakeuser,fakeuser2,aqtestregularuser,aqtestowneruser,aqtestnopermissionstestuser

# Cookie path for OIDC session
quarkus.oidc.authentication.cookie-path=/

# CORS Configuration
quarkus.http.cors.enabled=true
quarkus.http.cors.origins=http://localhost:4200,${QUARKUS_HTTP_CORS_ADDITIONAL_ORIGINS}
quarkus.http.cors.methods=GET,PUT,POST,DELETE,OPTIONS,HEAD
quarkus.http.cors.headers=accept,authorization,content-type,x-requested-with
quarkus.http.cors.access-control-allow-credentials=true

# Disable auto-redirect for XHR/Fetch requests to avoid CORS errors
quarkus.oidc.authentication.java-script-auto-redirect=false

# Dev Configuration for Keycloak
# %dev.auth.provider=keycloak
# %dev.quarkus.oidc.auth-server-url=http://localhost:9090/realms/quarkus
# %dev.quarkus.oidc.client-id=angular-quarkus-client
# %dev.quarkus.oidc.credentials.secret=secret
# Map Keycloak roles
# %dev.quarkus.oidc.roles.role-claim-path=realm_access/roles
quarkus.oidc.token.refresh-expired=true
quarkus.oidc.authentication.session-age-extension=12H

# Versioned GraphQL API endpoint
quarkus.smallrye-graphql.root-path=/api/v1/graphql

# AWS Cognito admin API settings
aws.region=${AWS_REGION}
cognito.user-pool-id=${COGNITO_USER_POOL_ID}

# Test port (dev server uses 8080)
quarkus.http.test-port=8081

%test.app.frontend-base-url=http://localhost:8081

# Keycloak Overrides (Dev/Test)
# (Duplicates removed)
%dev.cognito.domain=ignored
%dev.quarkus.oidc.authentication.cookie-path=/

%test.quarkus.oidc.auth-server-url=http://localhost:9090/realms/quarkus
%test.quarkus.oidc.client-id=angular-quarkus-client
%test.quarkus.oidc.credentials.secret=secret
%test.quarkus.oidc.roles.role-claim-path=realm_access/roles
%test.auth.provider=keycloak
%test.cognito.domain=ignored
%test.quarkus.oidc.authentication.cookie-path=/
%test.quarkus.oidc.roles.source=accesstoken
%test.quarkus.log.category."io.quarkus.oidc".level=DEBUG

%test.quarkus.log.category."io.quarkus.security".level=DEBUG

%dev.quarkus.oidc.roles.source=accesstoken

%dev.quarkus.keycloak.devservices.realm-path=../.github/keycloak/realm-export.json

# OIDC Secret for session encryption, override in production with a secure value (e.g. from .env or vault)
quarkus.oidc.token-state-manager.encryption-secret=0123456789abcdef0123456789abcdef

quarkus.dynamodb.aws.region=${AWS_REGION}
quarkus.dynamodb.aws.credentials.type=default

# Dev mode: Use LocalStack
%dev.quarkus.dynamodb.aws.region=us-east-1
%dev.quarkus.dynamodb.aws.credentials.type=static
%dev.quarkus.dynamodb.aws.credentials.static-provider.access-key-id=test
%dev.quarkus.dynamodb.aws.credentials.static-provider.secret-access-key=test
%dev.quarkus.dynamodb.endpoint-override=http://localhost:4566
# Disable Dev Services for DynamoDB, as we use a shared persistent container
%dev.quarkus.dynamodb.devservices.enabled=false

# Test mode: Use ephemeral Dev Services
%test.quarkus.dynamodb.devservices.enabled=true
%test.quarkus.dynamodb.devservices.shared=true
